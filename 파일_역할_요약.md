# íŒŒì¼ ì—­í•  ìš”ì•½ (í•µì‹¬ë§Œ)

## ğŸ¯ ê°€ì¥ ì¤‘ìš”í•œ 5ê°œ íŒŒì¼

### 1. `start-caspian.sh` â­â­â­â­â­
**í•œ ì¤„ ìš”ì•½**: ì „ì²´ ì‹œìŠ¤í…œì„ ìë™ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸

**ì‹¤í–‰**:
```bash
bash start-caspian.sh
```

**ê¸°ëŠ¥**:
- Spoke í´ëŸ¬ìŠ¤í„° 3ê°œ ìƒì„±
- Hub + Prometheus + Grafana ì‹œì‘
- í´ëŸ¬ìŠ¤í„° ìë™ ë“±ë¡
- 2-3ë¶„ì´ë©´ ëª¨ë“  ì¤€ë¹„ ì™„ë£Œ

---

### 2. `hub/app.py` â­â­â­â­â­
**í•œ ì¤„ ìš”ì•½**: Hub Clusterì˜ ë©”ì¸ API ì„œë²„

**í¬íŠ¸**: 8080

**í•µì‹¬ API**:
```bash
POST /hub/appwrappers   # Job ì œì¶œ
POST /hub/schedule      # ìŠ¤ì¼€ì¤„ë§
POST /hub/dispatch      # ë°°í¬
GET  /hub/stats         # ìƒíƒœ í™•ì¸
GET  /metrics           # Prometheus ë©”íŠ¸ë¦­
```

---

### 3. `hub/scheduler.py` â­â­â­â­â­
**í•œ ì¤„ ìš”ì•½**: CASPIAN ìŠ¤ì¼€ì¤„ëŸ¬ - íƒ„ì†Œ ìµœì í™” ì‹¤í–‰

**ì‹¤í–‰ ì£¼ê¸°**: 5ë¶„ë§ˆë‹¤ ìë™

**3ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤**:
```
1. Collect  â†’ í´ëŸ¬ìŠ¤í„° ì •ë³´ ìˆ˜ì§‘ (íƒ„ì†Œ ê°•ë„, ë¦¬ì†ŒìŠ¤)
2. Optimize â†’ MILP ìµœì í™” (ìµœì†Œ íƒ„ì†Œ ë°°ì¶œ)
3. Update   â†’ targetCluster ì„¤ì •, gate OPEN
```

---

### 4. `hub/dispatcher.py` â­â­â­â­â­
**í•œ ì¤„ ìš”ì•½**: Kubernetes Job ë°°í¬ ë‹´ë‹¹

**ì‹¤í–‰ ì£¼ê¸°**: 30ì´ˆë§ˆë‹¤ ìë™

**ë™ì‘**:
```
1. gate=OPENì¸ AppWrapper ì°¾ê¸°
2. Kubernetes Job ìƒì„±
3. Spoke í´ëŸ¬ìŠ¤í„°ì— ë°°í¬
4. ìƒíƒœ ì—…ë°ì´íŠ¸ (Running)
```

---

### 5. `app/optimizer.py` â­â­â­â­â­
**í•œ ì¤„ ìš”ì•½**: CASPIAN MILP ìµœì í™” ì•Œê³ ë¦¬ì¦˜

**ëª©ì **: íƒ„ì†Œ ë°°ì¶œ ìµœì†Œí™”

**ìˆ˜ì‹**:
```
minimize: Î£ (carbon_intensity Ã— energy)

ì œì•½:
- ê° Jobì€ 1ë²ˆë§Œ ìŠ¤ì¼€ì¤„ë§
- ë¦¬ì†ŒìŠ¤ ìš©ëŸ‰ ì œí•œ
- ì‹œê°„ ìœˆë„ìš° ì œì•½
```

---

## ğŸ“‚ ë””ë ‰í† ë¦¬ë³„ ì—­í• 

### `hub/` - Hub Cluster (í•µì‹¬)
```
hub/app.py        # API ì„œë²„ (8080)
hub/scheduler.py  # ìŠ¤ì¼€ì¤„ëŸ¬ (5ë¶„)
hub/dispatcher.py # ë””ìŠ¤íŒ¨ì²˜ (30ì´ˆ)
hub/store.py      # ë°ì´í„° ì €ì¥
hub/models.py     # ë°ì´í„° ëª¨ë¸
```

**ì—­í• **: ì¤‘ì•™ í—ˆë¸Œ - ëª¨ë“  ì œì–´ ë¡œì§

---

### `app/` - ê³µìœ  ì»´í¬ë„ŒíŠ¸
```
app/optimizer.py      # MILP ìµœì í™” â­
app/carbon_client.py  # íƒ„ì†Œ ë°ì´í„° ìˆ˜ì§‘ (10ì´ˆ)
app/metrics.py        # Prometheus ë©”íŠ¸ë¦­
app/schemas.py        # ë°ì´í„° ìŠ¤í‚¤ë§ˆ
```

**ì—­í• **: Hubì™€ ê³µìœ í•˜ëŠ” í•µì‹¬ ë¡œì§

---

### `dashboards/` - Grafana
```
carbon-hub-dashboard.json  # CASPIAN ëŒ€ì‹œë³´ë“œ
```

**íŒ¨ë„**: íƒ„ì†Œ ê°•ë„, AppWrapper í†µê³„, í´ëŸ¬ìŠ¤í„° ìƒíƒœ

---

### `grafana/provisioning/` - ìë™ ì„¤ì •
```
datasources/prometheus.yml  # Prometheus ì—°ê²°
dashboards/dashboard.yml    # ëŒ€ì‹œë³´ë“œ ë¡œë”©
```

**ì—­í• **: Grafana ì‹œì‘ ì‹œ ìë™ ì„¤ì •

---

## ğŸš€ ì‹œì‘ íŒŒì¼

### `start-caspian.sh` (ìë™)
**ì‚¬ìš©**: `bash start-caspian.sh`

**ë‚´ìš©**: ì „ì²´ ìë™í™”

---

### `docker-compose.yml`
**ì„œë¹„ìŠ¤**:
- hub (8080)
- prometheus (9090)
- grafana (3000)

---

### `Dockerfile`
**ì—­í• **: Hub ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¹Œë“œ

**í¬í•¨**: Python 3.11 + hub/ + app/

---

## ğŸ“– ë¬¸ì„œ íŒŒì¼

### ì½ê¸° ìˆœì„œ
1. **QUICKSTART.md** (1ë¶„) - ë¹ ë¥¸ ì‹œì‘
2. **README.md** (5ë¶„) - ì „ì²´ ê°œìš”
3. **ì‹œë™_ê°€ì´ë“œ.md** (í•„ìš”ì‹œ) - ìƒì„¸ ê°€ì´ë“œ
4. **í”„ë¡œì íŠ¸_êµ¬ì¡°.md** - ì „ì²´ íŒŒì¼ ì„¤ëª… â† ì§€ê¸ˆ ì—¬ê¸°

### ì°¸ê³  ë¬¸ì„œ
- **ì‹œìŠ¤í…œ_ì™„ë£Œ_ë³´ê³ ì„œ.md** - í˜„ì¬ ìƒíƒœ
- **HUB_SPOKE_êµ¬í˜„_ê°€ì´ë“œ.md** - êµ¬í˜„ ìƒì„¸
- **CASPIAN_ì•Œê³ ë¦¬ì¦˜_ì„¤ëª….md** - ì•Œê³ ë¦¬ì¦˜

---

## ğŸ”„ ì‹¤í–‰ íë¦„

```
ì‚¬ìš©ì
  â†“ bash start-caspian.sh
ìë™ ì‹œì‘ (2-3ë¶„)
  â†“
Hub API (8080) ì¤€ë¹„
  â†“ POST /hub/appwrappers
AppWrapper ì œì¶œ
  â†“ 5ë¶„ í›„
Scheduler â†’ CASPIAN ìµœì í™” â†’ targetCluster ê²°ì •
  â†“ 30ì´ˆ í›„
Dispatcher â†’ Kubernetes Job ë°°í¬
  â†“
Spoke Clusterì—ì„œ Job ì‹¤í–‰
```

---

## ğŸ’¾ ë°ì´í„° ì €ì¥

### `hub/store.py` (ì¸ë©”ëª¨ë¦¬)
```python
_appwrappers: Dict[str, AppWrapper]  # Job ëª©ë¡
_clusters: Dict[str, ClusterInfo]    # í´ëŸ¬ìŠ¤í„° ëª©ë¡
```

**íŠ¹ì§•**: ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ (ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”)

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### Prometheus (`prometheus.yml`)
```yaml
scrape_configs:
  - job_name: 'hub-cluster'
    targets: ['hub:8080']
    metrics_path: '/metrics'
```

**ìˆ˜ì§‘**: 10ì´ˆë§ˆë‹¤ Hub /metrics ìŠ¤í¬ë©

---

### Grafana (3000)
- **ID/PW**: admin/admin
- **ëŒ€ì‹œë³´ë“œ**: "CASPIAN Carbon-Aware Scheduling"
- **ê°±ì‹ **: 5ì´ˆë§ˆë‹¤

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

### `test_caspian.py`
**ì—­í• **: í†µí•© í…ŒìŠ¤íŠ¸

**ì‹¤í–‰**:
```bash
python test_caspian.py
```

---

### `test-job-*.yaml`
**ì—­í• **: Kubernetes Job ë§¤ë‹ˆí˜ìŠ¤íŠ¸

**í´ëŸ¬ìŠ¤í„°ë³„**:
- test-job-kr.yaml â†’ carbon-kr
- test-job-jp.yaml â†’ carbon-jp
- test-job-cn.yaml â†’ carbon-cn

---

## ğŸ—‘ï¸ ì‚­ì œí•´ë„ ë˜ëŠ” íŒŒì¼

### ë ˆê±°ì‹œ (ì‚¬ìš© ì•ˆ í•¨)
```
dev-run.sh
run_local.sh
start-hub-spoke.sh
start-system.bat
dashboards/carbon_dashboard.json
```

### ë¯¸ì‚¬ìš© ë””ë ‰í† ë¦¬
```
operator/    # K8s Operator (ë¯¸êµ¬í˜„)
k8s/         # ë§¤ë‹ˆí˜ìŠ¤íŠ¸ (ì°¸ê³ ìš©)
```

---

## âš™ï¸ ì„¤ì • íŒŒì¼

### `docker-compose.yml`
**í™˜ê²½ë³€ìˆ˜**:
```yaml
ELECTRICITYMAP_API_KEY: ebGFEg4L68pWwe68DdVu
CARBON_ZONES: KR,JP,CN
USE_MOCK_DATA: true
SCHEDULER_INTERVAL: 300  # 5ë¶„
DISPATCHER_INTERVAL: 30  # 30ì´ˆ
```

---

### `prometheus.yml`
**íƒ€ê²Ÿ**: hub:8080

---

### `kubeconfig-docker` (ìƒì„±ë¨)
**ì—­í• **: Docker ì»¨í…Œì´ë„ˆìš© kubeconfig

**ë³€í™˜**:
```
localhost:56861 â†’ carbon-kr-control-plane:6443
```

---

## ğŸ“ í•µì‹¬ í¬ì¸íŠ¸

### ì‹œìŠ¤í…œ ì‹œì‘
```bash
bash start-caspian.sh
```

### ìƒíƒœ í™•ì¸
```bash
curl http://localhost:8080/hub/stats
```

### Job ì œì¶œ
```bash
curl -X POST http://localhost:8080/hub/appwrappers \
  -H "Content-Type: application/json" \
  -d '{"job_id":"test","cpu":2.0,"mem_gb":4.0,"runtime_minutes":30,"deadline_minutes":120}'
```

### ëŒ€ì‹œë³´ë“œ
http://localhost:3000 (admin/admin)

---

## ğŸ¯ ê¸°ì–µí•´ì•¼ í•  3ê°€ì§€

1. **ì‹œì‘**: `bash start-caspian.sh`
2. **Hub API**: http://localhost:8080
3. **Grafana**: http://localhost:3000

**ê·¸ê²Œ ì „ë¶€!** ğŸš€

---

**ìƒì„¸ ì •ë³´**: [í”„ë¡œì íŠ¸_êµ¬ì¡°.md](í”„ë¡œì íŠ¸_êµ¬ì¡°.md) ì°¸ì¡°
